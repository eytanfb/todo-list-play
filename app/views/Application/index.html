#{extends 'main.html' /}
#{set title:'Home' /}

#{form @ItemsController.addItem(), method:'POST'}
  <fieldset class="col-lg-6"> 
    #{ifErrors}
      <p class="errors">All fields required</p>
    #{/ifErrors}
    <div class="form-group">
      <label for="item">Add new todo</label>
      <input type="text" class="form-control" name="item" id="item" />
    </div>
       <input type="submit" name="submit" id="" class="btn btn-success" value="Add Item" />
  </fieldset>
#{/form}

<ul>
  #{list items:items, as: 'item'}
    <li id='${item.id}'>
      <input type="checkbox" name="complete" id="complete" ${item.isComplete ? "checked" : ""} />
      <a href="@{ItemsController.show(item.id)}" class="${item.isComplete ? 'complete' : 'incomplete'}">${item.content} (${item.subItems.size()} sub item${item.subItems.size().pluralize()})</a>
    </li>
  #{/list}
</ul>

<script type="text/javascript" charset="utf-8">
  $(function(){
    $("input[type=checkbox]").click(function(e){
      var li = $(this.parentNode);
      var id = li.attr("id");
      var isComplete = li.find("input[type=checkbox]").prop("checked");
      var markComplete = #{jsAction @ItemsController.markComplete(":id", ":isComplete") /};
      $.post(markComplete({id: id, isComplete: isComplete}), function(){
        if(isComplete) li.find("a").attr("class", "complete");
        else li.find("a").attr("class", "incomplete");
      });
    });
  });
</script>
